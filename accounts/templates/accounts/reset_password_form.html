<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nova senha</title>
<style>
body { font-family: Arial,sans-serif; background:#f2f2f2; display:flex; justify-content:center; align-items:center; height:100vh; }
.container { background:#fff; padding:40px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); text-align:center; max-width:400px; width:100%; }
input { width:100%; padding:12px; margin:10px 0; border-radius:5px; border:1px solid #ccc; font-size:16px; }
button { padding:12px 25px; font-size:16px; background:#28a745; color:#fff; border:none; border-radius:5px; cursor:pointer; }
button:hover { background:#218838; }
.message { margin-top:20px; font-size:14px; color: green; }
.error { color:red; }
</style>
</head>
<body>
<div class="container">
    <h2>Defina sua nova senha</h2>
    <input type="password" id="password" placeholder="Nova senha">
    <input type="password" id="confirm_password" placeholder="Confirme a senha">
    <button id="submitBtn">Redefinir senha</button>
    <div class="message" id="message"></div>
</div>

<script>
const urlParams = new URLSearchParams(window.location.search);
const uid = urlParams.get('uid');
const token = urlParams.get('token');

document.getElementById('submitBtn').addEventListener('click', async () => {
    const password = document.getElementById('password').value;
    const confirm_password = document.getElementById('confirm_password').value;
    const messageDiv = document.getElementById('message');
    messageDiv.textContent = '';

    try {
        const res = await fetch(`/auth/reset-password/?uid=${uid}&token=${token}`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ password, confirm_password })
        });
        const data = await res.json();
        if(res.ok){
            messageDiv.textContent = "Senha redefinida com sucesso!";
            messageDiv.classList.remove('error');
        } else {
            messageDiv.textContent = data.detail || "Erro ao redefinir senha.";
            messageDiv.classList.add('error');
        }
    } catch(err){
        messageDiv.textContent = "Erro de rede, tente novamente.";
        messageDiv.classList.add('error');
    }
});
</script>
</body>
</html>
